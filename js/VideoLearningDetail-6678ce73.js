import{j as e}from"./chunk-9a18e39e.js";import{e as a,u as t,b as s,r,L as i}from"./chunk-324910f1.js";import{i as l,w as n,r as d,p as o,q as c,l as m,m as x,y as p,z as y,s as u,A as g,B as h,C as f}from"./index-5373f156.js";import{f as j}from"./chunk-abc135ce.js";import{a as b,b as v,c as k}from"./chunk-dcfb9192.js";import{u as N}from"./chunk-52ed7ddd.js";import{e as w,r as I}from"./chunk-5cf4a90d.js";import{R as T}from"./chunk-5462ce7c.js";import{u as _}from"./chunk-4f2364f3.js";import{u as C}from"./chunk-43ad9be7.js";import{m as A}from"./chunk-816c63d1.js";import{M as P}from"./chunk-05d807e2.js";const Y=()=>{const{id:Y}=a(),B=t(),M=s(),{isAuthenticated:R}=l(),{i18n:E}=C();E.language;const{data:L,isLoading:S,isError:D,error:U}=b(Y),q=v(),F=k(),{skillCategories:V}=N(),{success:z,error:H}=_(),O=r.useRef(null),$=r.useRef(null),[G,J]=r.useState(!1),[K,Q]=r.useState(!1),[W,X]=r.useState(""),Z=r.useMemo(()=>(null==L?void 0:L.videoId)?L.videoId:(null==L?void 0:L.videoUrl)?w(L.videoUrl):null,[L]);r.useEffect(()=>{if(!Z)return;if(!window.YT){const e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";const a=document.getElementsByTagName("script")[0];(null==a?void 0:a.parentNode)&&a.parentNode.insertBefore(e,a)}const e=()=>{window.YT&&window.YT.Player&&$.current&&(O.current=new window.YT.Player($.current,{videoId:Z,playerVars:{enablejsapi:1,origin:window.location.origin,rel:0,modestbranding:1,fs:1,cc_load_policy:0,iv_load_policy:3,showinfo:0,controls:1},events:{onReady:()=>{J(!0)}}}))};return window.YT&&window.YT.Player?e():window.onYouTubeIframeAPIReady=e,()=>{O.current&&"function"==typeof O.current.destroy&&O.current.destroy()}},[Z]);const ee=r.useMemo(()=>{if(!(null==L?void 0:L.skillIds)||!V)return[];return V.flatMap(e=>e.skills||[]).filter(e=>{var a;return e._id&&(null==(a=L.skillIds)?void 0:a.includes(e._id))})},[L,V]),ae=q.isPending;return S?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-primary-600 border-t-transparent rounded-full animate-spin"})}):L?e.jsx("section",{className:"min-h-screen bg-white dark:bg-dark-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-6",children:e.jsxs(i,{to:"/video-learnings",state:M.state,className:"inline-flex items-center gap-2 text-primary-600 hover:text-primary-700",children:[e.jsx(d,{})," 목록으로 돌아가기"]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"w-full lg:w-7/12 lg:sticky lg:top-8 self-start",children:[Z&&e.jsx(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-6",children:e.jsxs("div",{className:"aspect-video rounded-xl overflow-hidden shadow-2xl bg-black relative",children:[e.jsx("div",{ref:$,className:"w-full h-full"}),!G&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75",children:e.jsx("div",{className:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin"})})]})}),e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"card p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:L.categoryIds&&L.categoryIds.length>0?L.categoryIds.map(a=>{const t="string"==typeof a?a:null==a?void 0:a.name;return t?e.jsx("span",{className:"px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 rounded-full text-sm font-medium",children:t},"string"==typeof a?a:null==a?void 0:a._id):null}):L.category&&e.jsx("span",{className:"px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 rounded-full text-sm font-medium",children:L.category})}),R&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{to:"/admin",state:{tab:"videoLearnings",editId:L._id},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-blue-600 dark:text-blue-400","aria-label":"영상 수정",children:e.jsx(o,{})}),e.jsx("button",{onClick:async()=>{if(confirm("이 영상 학습 기록을 삭제하시겠습니까?"))try{await q.mutateAsync(Y),B("/video-learnings")}catch(e){}},disabled:ae,className:"p-2 rounded-lg text-red-600 dark:text-red-400 transition-colors "+(ae?"opacity-50 cursor-not-allowed":"hover:bg-gray-100 dark:hover:bg-gray-700"),"aria-label":"영상 삭제",children:ae?e.jsx("div",{className:"w-4 h-4 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):e.jsx(c,{})})]})]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:L.title}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400",children:[L.rating&&e.jsxs("div",{className:"flex items-center gap-2",children:[Array.from({length:5},(a,t)=>e.jsx(m,{className:"text-sm "+(t<L.rating?"text-yellow-500":"text-gray-300 dark:text-gray-600")},t)),e.jsxs("span",{className:"font-medium",children:[L.rating,"/5"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{}),e.jsx("span",{children:j(L.watchDate)})]})]})]}),L.purpose&&e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"card p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(p,{className:"text-blue-600"})," 시청 목적"]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 text-sm",children:e.jsx(P,{children:L.purpose})})]}),L.application&&e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"card p-6 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border-l-4 border-purple-600",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(y,{className:"text-purple-600"})," 적용 계획"]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 text-sm",children:e.jsx(P,{children:L.application})})]})]}),e.jsxs("div",{className:"w-full lg:w-5/12 space-y-6",children:[ee.length>0&&e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"card p-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(u,{className:"text-primary-600"})," 학습한 기술"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ee.map(a=>e.jsx("div",{className:"inline-flex items-center px-3 py-1 rounded-lg text-sm font-medium",style:{backgroundColor:`${a.color}26`,color:a.color},children:a.name},a._id))})]}),(L.keyTakeaways||R)&&e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"card p-6 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-l-4 border-blue-600",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(g,{className:"text-yellow-500"})," 핵심 배움"]}),R&&!K&&e.jsx("button",{onClick:()=>{Q(!0),X((null==L?void 0:L.keyTakeaways)||"")},className:"p-1.5 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded transition-colors",title:"핵심 배움 편집",children:e.jsx(o,{className:"text-sm"})})]}),L.createdAt&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["기록 날짜: ",j(L.createdAt)]})]}),!K&&e.jsx(e.Fragment,{children:L.keyTakeaways?e.jsx(e.Fragment,{children:e.jsx("div",{className:"prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300",dangerouslySetInnerHTML:{__html:I(L.keyTakeaways)},onClick:e=>{const a=e.target;if("BUTTON"===a.tagName&&a.dataset.timestamp){(e=>{if(O.current&&G)try{O.current.seekTo(e,!0),O.current.playVideo()}catch(a){}})(parseInt(a.dataset.timestamp,10))}}})}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"text-sm",children:"이 영상의 핵심 배움이 아직 기록되지 않았습니다"}),R&&e.jsx("p",{className:"text-xs mt-2",children:"위의 연필 버튼을 클릭하여 학습 기록을 추가하세요"})]})}),K&&e.jsxs("div",{children:[e.jsx(T,{value:W,onChange:X,placeholder:"영상을 보면서 핵심 배움을 작성하세요. 리치텍스트 에디터를 사용하여 다양한 서식을 적용할 수 있습니다.",rows:8,className:"min-h-[250px]"}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs("button",{onClick:async()=>{var e,a;if(L&&Y)try{const e=(L.skillIds||[]).map(e=>"string"==typeof e?e:null==e?void 0:e._id).filter(Boolean),a=(L.categoryIds||[]).map(e=>"string"==typeof e?e:null==e?void 0:e._id).filter(Boolean),t={title:L.title,videoId:L.videoId,category:L.category,categoryIds:a,watchDate:L.watchDate,purpose:L.purpose,keyTakeaways:W,application:L.application,skillIds:e,rating:L.rating,order:L.order};await F.mutateAsync({id:Y,data:t}),z("저장 완료","핵심 배움이 저장되었습니다."),Q(!1),X("")}catch(t){H("저장 실패",(null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.message)||"핵심 배움 저장 중 오류가 발생했습니다.")}},disabled:F.isPending,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors text-sm font-medium",children:[e.jsx(h,{}),F.isPending?"저장 중...":"저장"]}),e.jsxs("button",{onClick:()=>{Q(!1),X("")},disabled:F.isPending,className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors text-sm font-medium",children:[e.jsx(f,{}),"취소"]})]})]})]})]})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(n,{className:"text-6xl text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400",children:"영상 학습 기록을 찾을 수 없습니다"}),e.jsx(i,{to:"/video-learnings",state:M.state,className:"text-primary-600 hover:text-primary-700 mt-4 inline-block",children:"목록으로 돌아가기"})]})})};export{Y as default};
//# sourceMappingURL=VideoLearningDetail-6678ce73.js.map
