import{j as e}from"./chunk-9a18e39e.js";import{e as a,u as t,b as s,r,L as i}from"./chunk-324910f1.js";import{i as l,D as n,r as d,p as c,q as o,l as x,m,y,z as p,s as g,E as h,G as u,B as f,C as j}from"./index-5373f156.js";import{f as b}from"./chunk-abc135ce.js";import{a as v,b as N,c as k,d as w}from"./chunk-7523ae4e.js";import{u as I}from"./chunk-52ed7ddd.js";import{r as _}from"./chunk-5cf4a90d.js";import{R as T}from"./chunk-5462ce7c.js";import{u as C}from"./chunk-4f2364f3.js";import{u as P}from"./chunk-43ad9be7.js";import{m as A}from"./chunk-816c63d1.js";import{M as S}from"./chunk-05d807e2.js";const Y=()=>{const{id:Y}=a(),E=t(),M=s(),{isAuthenticated:R}=l(),{i18n:B}=P();B.language;const{data:D,isLoading:L}=v(Y),{data:V=[]}=N(Y),q=k(),z=w(),{skillCategories:F}=I(),{success:G,error:H}=C(),O=r.useRef(null),U=r.useRef(null),[$,J]=r.useState(!1),[K,Q]=r.useState(null);r.useState(null);const[W,X]=r.useState(null),[Z,ee]=r.useState(!0),[ae,te]=r.useState(null),[se,re]=r.useState("");r.useEffect(()=>{V.length>0&&!K&&V[0]&&Q(V[0].videoId)},[V,K]),r.useEffect(()=>{if(!(null==D?void 0:D.playlistId))return;if(!window.YT){const e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";const a=document.getElementsByTagName("script")[0];(null==a?void 0:a.parentNode)&&a.parentNode.insertBefore(e,a)}const e=()=>{window.YT&&window.YT.Player&&U.current&&(O.current=new window.YT.Player(U.current,{playerVars:{listType:"playlist",list:D.playlistId,enablejsapi:1,origin:window.location.origin,rel:0,modestbranding:1,fs:1,cc_load_policy:0,iv_load_policy:3,showinfo:0},events:{onReady:()=>{J(!0)}}}))};return window.YT&&window.YT.Player?e():window.onYouTubeIframeAPIReady=e,()=>{O.current&&"function"==typeof O.current.destroy&&O.current.destroy()}},[null==D?void 0:D.playlistId]),r.useEffect(()=>{V.length>0&&!W&&V[0]&&X(V[0]._id)},[V,W]);const ie=r.useMemo(()=>{if(!(null==D?void 0:D.skillIds)||!F)return[];return F.flatMap(e=>e.skills||[]).filter(e=>{var a;return e._id&&(null==(a=D.skillIds)?void 0:a.includes(e._id))})},[D,F]),le=r.useMemo(()=>V.find(e=>e._id===W),[V,W]),ne=(e,a)=>{if($&&O.current)try{const t=V.findIndex(a=>a.videoId===e);if(-1===t)return;O.current.playVideoAt(t),Q(e),setTimeout(()=>{O.current.seekTo(a,!0),O.current.playVideo()},1e3)}catch(t){}};return L?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-primary-600 border-t-transparent rounded-full animate-spin"})}):D?e.jsx("section",{className:"min-h-screen bg-white dark:bg-dark-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-6",children:e.jsxs(i,{to:"/video-learnings",state:M.state,className:"inline-flex items-center gap-2 text-primary-600 hover:text-primary-700",children:[e.jsx(d,{})," 목록으로 돌아가기"]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"w-full lg:w-7/12 lg:sticky lg:top-8 self-start",children:[D.playlistId&&e.jsx(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-6",children:e.jsxs("div",{className:"aspect-video rounded-xl overflow-hidden shadow-2xl bg-black relative",children:[e.jsx("div",{ref:U,className:"w-full h-full"}),!$&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75",children:e.jsx("div",{className:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin"})})]})}),e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"card p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:D.categoryIds&&D.categoryIds.length>0?D.categoryIds.map(a=>{const t="string"==typeof a?a:null==a?void 0:a.name;return t?e.jsx("span",{className:"px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 rounded-full text-sm font-medium",children:t},"string"==typeof a?a:null==a?void 0:a._id):null}):D.category&&e.jsx("span",{className:"px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 rounded-full text-sm font-medium",children:D.category})}),R&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{to:"/admin",state:{tab:"videoPlaylists",editId:D._id},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-blue-600 dark:text-blue-400","aria-label":"재생 목록 수정",children:e.jsx(c,{})}),e.jsx("button",{onClick:async()=>{if(confirm("이 재생 목록을 삭제하시겠습니까?"))try{await q.mutateAsync(Y),E("/video-learnings")}catch(e){}},disabled:q.isPending,className:"p-2 rounded-lg text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700","aria-label":"재생 목록 삭제",children:e.jsx(o,{})})]})]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:D.title}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400",children:[D.rating&&e.jsxs("div",{className:"flex items-center gap-2",children:[Array.from({length:5},(a,t)=>e.jsx(x,{className:"text-sm "+(t<D.rating?"text-yellow-500":"text-gray-300 dark:text-gray-600")},t)),e.jsxs("span",{className:"font-medium",children:[D.rating,"/5"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{}),e.jsx("span",{children:b(D.watchDate)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{}),e.jsxs("span",{children:[V.length,"개 영상"]})]})]})]}),D.purpose&&e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"card p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(y,{className:"text-blue-600"})," 시청 목적"]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 text-sm",children:e.jsx(S,{children:D.purpose})})]}),D.application&&e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"card p-6 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border-l-4 border-purple-600",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(p,{className:"text-purple-600"})," 통합 적용 계획"]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 text-sm",children:e.jsx(S,{children:D.application})})]})]}),e.jsxs("div",{className:"w-full lg:w-5/12 space-y-6",children:[ie.length>0&&e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"card p-6 mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(g,{className:"text-primary-600"})," 학습한 기술"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ie.map(a=>e.jsx("div",{className:"inline-flex items-center px-3 py-1 rounded-lg text-sm font-medium",style:{backgroundColor:`${a.color}26`,color:a.color},children:a.name},a._id))})]}),e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"card p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("button",{onClick:()=>ee(!Z),className:"flex items-center gap-2 text-xl font-bold text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors",children:[Z?e.jsx(h,{}):e.jsx(u,{}),"📹 영상별 학습 기록 (",V.length,"개)"]})}),Z&&V.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:V.map((a,t)=>e.jsxs("button",{onClick:()=>(e=>{X(e._id),ne(e.videoId,0)})(a),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+(W===a._id?"bg-primary-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:["#",t+1," ",a.title]},a._id))}),V.length>0&&le?e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800",children:[e.jsx("h4",{className:"font-bold text-gray-900 dark:text-white mb-1",children:le.title}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["유튜브 영상 ID: ",le.videoId]}),le.createdAt&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["기록 날짜: ",b(le.createdAt)]})]}),R&&ae!==le._id&&e.jsx("button",{onClick:()=>{return te((e=le)._id),void re(e.keyTakeaways||"");var e},className:"p-1.5 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded transition-colors",title:"핵심 배움 편집",children:e.jsx(c,{className:"text-sm"})})]})]}),ae!==le._id&&e.jsx(e.Fragment,{children:le.keyTakeaways?e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-900",children:[e.jsx("h5",{className:"text-sm font-bold text-gray-700 dark:text-gray-300 mb-3",children:"🎯 핵심 배움"}),e.jsx("div",{className:"prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 leading-relaxed",dangerouslySetInnerHTML:{__html:_(le.keyTakeaways)},onClick:e=>{const a=e.target;if("BUTTON"===a.tagName&&a.dataset.timestamp){const e=parseInt(a.dataset.timestamp,10);ne(le.videoId,e)}}})]}):e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-900 text-center text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"text-sm",children:"이 영상의 핵심 배움이 아직 기록되지 않았습니다"}),R&&e.jsx("p",{className:"text-xs mt-2",children:"위의 연필 버튼을 클릭하여 학습 기록을 추가하세요"})]})}),ae===le._id&&e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-900",children:[e.jsx("h5",{className:"text-sm font-bold text-gray-700 dark:text-gray-300 mb-3",children:"✏️ 핵심 배움 편집"}),e.jsx(T,{value:se,onChange:re,placeholder:"영상을 보면서 핵심 배움을 작성하세요. 리치텍스트 에디터를 사용하여 다양한 서식을 적용할 수 있습니다.",rows:8,className:"min-h-[250px]"}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs("button",{onClick:async()=>{if(ae&&le)try{await z.mutateAsync({id:ae,data:{playlistId:Y,videoId:le.videoId,title:le.title,keyTakeaways:se,order:le.order||0}}),G("저장 완료","핵심 배움이 저장되었습니다."),te(null),re("")}catch(e){H("저장 실패","핵심 배움 저장 중 오류가 발생했습니다.")}},disabled:z.isPending,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors text-sm font-medium",children:[e.jsx(f,{}),z.isPending?"저장 중...":"저장"]}),e.jsxs("button",{onClick:()=>{te(null),re("")},disabled:z.isPending,className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors text-sm font-medium",children:[e.jsx(j,{}),"취소"]})]})]})]}):0===V.length?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"mb-4",children:"아직 등록된 영상 학습 기록이 없습니다"}),R&&e.jsx("p",{className:"text-sm",children:"관리자 페이지의 재생 목록 수정에서 영상을 추가해주세요"})]}):null]})]})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(n,{className:"text-6xl text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400",children:"재생 목록을 찾을 수 없습니다"}),e.jsx(i,{to:"/video-learnings",state:M.state,className:"text-primary-600 hover:text-primary-700 mt-4 inline-block",children:"목록으로 돌아가기"})]})})};export{Y as default};
//# sourceMappingURL=VideoPlaylistDetail-a7f01934.js.map
