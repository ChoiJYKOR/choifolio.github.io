import{O as Q,P as X,A as O,B as ee,j as ae,r as l,k as e,a2 as R,L as w,q as o,R as te,K as F,N as se,l as x,E as re,G as ie,Z as ne,_ as A,T as le,a3 as de,a4 as oe,a0 as ce,a1 as xe}from"./index-1fe3a1ef.js";import{f as M}from"./dateUtils-19c0cc10.js";import{a as me,b as ye,c as pe,d as ge}from"./useVideoPlaylists-b6c4c69e.js";import{u as ue}from"./useSkills-77227ec9.js";import{r as he}from"./videoUtils-df590320.js";import{R as fe}from"./RichTextEditor-fcc52ff1.js";import{d as be,E as ke}from"./detector-bcdba050.js";import{u as je}from"./useToast-1773be8d.js";import{S as ve,M as J}from"./StickyVideoPlayer-560e3893.js";import"./useMutation-31c06883.js";const Le=()=>{const{id:p}=Q(),D=X(),T=O(),{isAuthenticated:g}=ee(),{i18n:Y,t:u}=ae(),c=Y.language,{data:t,isLoading:B}=me(p),{data:r=[]}=ye(p),_=pe(),h=ge(),{skillCategories:k}=ue(),{success:H,error:U}=je(),d=l.useRef(null),j=l.useRef(null),[E,C]=l.useState(!1),[f,P]=l.useState(null);l.useState(null);const[m,S]=l.useState(null),[v,$]=l.useState(!0),[y,N]=l.useState(null),[V,b]=l.useState("");l.useEffect(()=>{r.length>0&&!f&&r[0]&&P(r[0].videoId)},[r,f]),l.useEffect(()=>{if(!(t!=null&&t.playlistId))return;if(!window.YT){const s=document.createElement("script");s.src="https://www.youtube.com/iframe_api";const n=document.getElementsByTagName("script")[0];n!=null&&n.parentNode&&n.parentNode.insertBefore(s,n)}const a=()=>{window.YT&&window.YT.Player&&j.current&&(d.current=new window.YT.Player(j.current,{playerVars:{listType:"playlist",list:t.playlistId,enablejsapi:1,origin:window.location.origin,rel:0,modestbranding:1,fs:1,cc_load_policy:0,iv_load_policy:3,showinfo:0},events:{onReady:()=>{C(!0)}}}))};return window.YT&&window.YT.Player?a():window.onYouTubeIframeAPIReady=a,()=>{d.current&&typeof d.current.destroy=="function"&&d.current.destroy()}},[t==null?void 0:t.playlistId]),l.useEffect(()=>{r.length>0&&!m&&r[0]&&S(r[0]._id)},[r,m]);const I=l.useMemo(()=>!(t!=null&&t.skillIds)||!k?[]:k.flatMap(s=>s.skills||[]).filter(s=>{var n;return s._id&&((n=t.skillIds)==null?void 0:n.includes(s._id))}),[t,k]),i=l.useMemo(()=>r.find(a=>a._id===m),[r,m]),z=(a,s)=>{S(a._id),L(a.videoId,0)},L=(a,s)=>{if(!(!E||!d.current))try{const n=r.findIndex(Z=>Z.videoId===a);if(n===-1)return;d.current.playVideoAt(n),P(a),setTimeout(()=>{d.current.seekTo(s,!0),d.current.playVideo()},1e3)}catch(n){console.error("íƒ€ì„ìŠ¤íƒ¬í”„ ì´ë™ ì‹¤íŒ¨:",n)}},q=async()=>{if(confirm("ì´ ì¬ìƒ ëª©ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))try{await _.mutateAsync(p),D("/video-learnings")}catch(a){console.error("ì‚­ì œ ì‹¤íŒ¨:",a)}},G=a=>{N(a._id),b(a.keyTakeaways||"")},K=()=>{N(null),b("")},W=async()=>{if(!(!y||!i))try{await h.mutateAsync({id:y,data:{playlistId:p,videoId:i.videoId,title:i.title,keyTakeaways:V,order:i.order||0}}),H("ì €ì¥ ì™„ë£Œ","í•µì‹¬ ë°°ì›€ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."),N(null),b("")}catch(a){U("ì €ì¥ ì‹¤íŒ¨","í•µì‹¬ ë°°ì›€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),console.error("í•µì‹¬ ë°°ì›€ ì €ì¥ ì‹¤íŒ¨:",a)}};return B?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-primary-600 border-t-transparent rounded-full animate-spin"})}):t?e.jsx("section",{className:"min-h-screen bg-white dark:bg-dark-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs(w,{to:"/video-learnings",state:T.state,className:"inline-flex items-center gap-2 text-primary-600 hover:text-primary-700 mb-6",children:[e.jsx(te,{})," ",u("videoLearnings.backToList")]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"w-full lg:w-7/12 lg:sticky lg:top-8 self-start",children:[t.playlistId&&f&&e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-6",children:[e.jsx(ve,{videoId:f,playerRef:j,onPlayerReady:()=>C(!0)}),!E&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75 rounded-xl pointer-events-none",children:e.jsx("div",{className:"w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin"})})]}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"card p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:t.categoryIds&&t.categoryIds.length>0?t.categoryIds.map(a=>{const s=typeof a=="string"?a:a==null?void 0:a.name;return s?e.jsx("span",{className:"px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 rounded-full text-sm font-medium",children:s},typeof a=="string"?a:a==null?void 0:a._id):null}):t.category&&e.jsx("span",{className:"px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 rounded-full text-sm font-medium",children:t.category})}),g&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{to:"/admin",state:{tab:"videoPlaylists",editId:t._id},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-blue-600 dark:text-blue-400","aria-label":"ì¬ìƒ ëª©ë¡ ìˆ˜ì •",children:e.jsx(F,{})}),e.jsx("button",{onClick:q,disabled:_.isPending,className:"p-2 rounded-lg text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700","aria-label":"ì¬ìƒ ëª©ë¡ ì‚­ì œ",children:e.jsx(se,{})})]})]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:x(c,t.title,t.titleEn,t.titleJa)}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400",children:[t.rating&&e.jsxs("div",{className:"flex items-center gap-2",children:[Array.from({length:5},(a,s)=>e.jsx(re,{className:`text-sm ${s<t.rating?"text-yellow-500":"text-gray-300 dark:text-gray-600"}`},s)),e.jsxs("span",{className:"font-medium",children:[t.rating,"/5"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{}),e.jsx("span",{children:M(t.watchDate)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{}),e.jsxs("span",{children:[r.length,"ê°œ ì˜ìƒ"]})]})]})]}),x(c,t.purpose,t.purposeEn,t.purposeJa)&&e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"card p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(ne,{className:"text-blue-600"})," ",u("videoLearnings.purpose")]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 text-sm",children:e.jsx(J,{children:x(c,t.purpose,t.purposeEn,t.purposeJa)||""})})]}),x(c,t.keyTakeaways,t.keyTakeawaysEn,t.keyTakeawaysJa)&&e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.25},className:"card p-6 mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(A,{className:"text-green-600"})," í•µì‹¬ ë°°ì›€"]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300",children:(()=>{const a=x(c,t.keyTakeaways,t.keyTakeawaysEn,t.keyTakeawaysJa)||"";return be(a)==="editorjs"?e.jsx(ke,{data:a,className:"min-h-[100px]"}):e.jsx("div",{dangerouslySetInnerHTML:{__html:a},className:"min-h-[100px]"})})()})]}),x(c,t.application,t.applicationEn,t.applicationJa)&&e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"card p-6 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border-l-4 border-purple-600",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(A,{className:"text-purple-600"})," ",u("videoLearnings.application")]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 text-sm",children:e.jsx(J,{children:x(c,t.application,t.applicationEn,t.applicationJa)||""})})]})]}),e.jsxs("div",{className:"w-full lg:w-5/12 space-y-6",children:[I.length>0&&e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"card p-6 mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(le,{className:"text-primary-600"})," í•™ìŠµí•œ ê¸°ìˆ "]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(a=>e.jsx("div",{className:"inline-flex items-center px-3 py-1 rounded-lg text-sm font-medium",style:{backgroundColor:`${a.color}26`,color:a.color},children:a.name},a._id))})]}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"card p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("button",{onClick:()=>$(!v),className:"flex items-center gap-2 text-xl font-bold text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors",children:[v?e.jsx(de,{}):e.jsx(oe,{}),"ğŸ“¹ ì˜ìƒë³„ í•™ìŠµ ê¸°ë¡ (",r.length,"ê°œ)"]})}),v&&r.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:r.map((a,s)=>e.jsxs("button",{onClick:()=>z(a),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${m===a._id?"bg-primary-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["#",s+1," ",a.title]},a._id))}),r.length>0&&i?e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800",children:[e.jsx("h4",{className:"font-bold text-gray-900 dark:text-white mb-1",children:i.title}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ìœ íŠœë¸Œ ì˜ìƒ ID: ",i.videoId]}),i.createdAt&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ê¸°ë¡ ë‚ ì§œ: ",M(i.createdAt)]})]}),g&&y!==i._id&&e.jsx("button",{onClick:()=>G(i),className:"p-1.5 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded transition-colors",title:"í•µì‹¬ ë°°ì›€ í¸ì§‘",children:e.jsx(F,{className:"text-sm"})})]})]}),y!==i._id&&e.jsx(e.Fragment,{children:i.keyTakeaways?e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-900",children:[e.jsx("h5",{className:"text-sm font-bold text-gray-700 dark:text-gray-300 mb-3",children:"ğŸ¯ í•µì‹¬ ë°°ì›€"}),e.jsx("div",{className:"prose dark:prose-invert max-w-none text-gray-700 dark:text-gray-300 leading-relaxed",dangerouslySetInnerHTML:{__html:he(i.keyTakeaways)},onClick:a=>{const s=a.target;if(s.tagName==="BUTTON"&&s.dataset.timestamp){const n=parseInt(s.dataset.timestamp,10);L(i.videoId,n)}}})]}):e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-900 text-center text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"text-sm",children:"ì´ ì˜ìƒì˜ í•µì‹¬ ë°°ì›€ì´ ì•„ì§ ê¸°ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"}),g&&e.jsx("p",{className:"text-xs mt-2",children:"ìœ„ì˜ ì—°í•„ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í•™ìŠµ ê¸°ë¡ì„ ì¶”ê°€í•˜ì„¸ìš”"})]})}),y===i._id&&e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-900",children:[e.jsx("h5",{className:"text-sm font-bold text-gray-700 dark:text-gray-300 mb-3",children:"âœï¸ í•µì‹¬ ë°°ì›€ í¸ì§‘"}),e.jsx(fe,{value:V,onChange:b,placeholder:"ì˜ìƒì„ ë³´ë©´ì„œ í•µì‹¬ ë°°ì›€ì„ ì‘ì„±í•˜ì„¸ìš”. ë¦¬ì¹˜í…ìŠ¤íŠ¸ ì—ë””í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ì–‘í•œ ì„œì‹ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",rows:8,className:"min-h-[250px]"}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs("button",{onClick:W,disabled:h.isPending,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors text-sm font-medium",children:[e.jsx(ce,{}),h.isPending?"ì €ì¥ ì¤‘...":"ì €ì¥"]}),e.jsxs("button",{onClick:K,disabled:h.isPending,className:"flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors text-sm font-medium",children:[e.jsx(xe,{}),"ì·¨ì†Œ"]})]})]})]}):r.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"mb-4",children:"ì•„ì§ ë“±ë¡ëœ ì˜ìƒ í•™ìŠµ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤"}),g&&e.jsx("p",{className:"text-sm",children:"ê´€ë¦¬ì í˜ì´ì§€ì˜ ì¬ìƒ ëª©ë¡ ìˆ˜ì •ì—ì„œ ì˜ìƒì„ ì¶”ê°€í•´ì£¼ì„¸ìš”"})]}):null]})]})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(R,{className:"text-6xl text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400",children:"ì¬ìƒ ëª©ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),e.jsx(w,{to:"/video-learnings",state:T.state,className:"text-primary-600 hover:text-primary-700 mt-4 inline-block",children:u("videoLearnings.backToList")})]})})};export{Le as default};
