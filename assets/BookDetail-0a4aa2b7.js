import{H as Z,r as f,I as B,j as oe,k as e,q as k,J as se,l as M,K as de,N as ce,L as W,O as je,P as ve,A as ke,B as Ne,Q as we,y as V,R as Ce,G as Ee,T as _e,C as ne,U as O,V as Se,W as ie,E as Fe}from"./index-1fe3a1ef.js";import{f as ge,a as Le}from"./dateUtils-19c0cc10.js";import{B as N,a as Ae,b as $e}from"./useBooks-2ae1e263.js";import{u as ee}from"./useMutation-31c06883.js";import{R as X}from"./RichTextEditor-fcc52ff1.js";import{L as qe}from"./LanguageTabs-5b8d5eb3.js";import{d as xe,E as me}from"./detector-bcdba050.js";import{u as Te}from"./useSkills-77227ec9.js";const Qe=a=>{const o=Z();return ee({mutationFn:async x=>(await B.createForBook(a,x)).data,onSuccess:()=>{o.invalidateQueries({queryKey:[N,"detail",a]}),o.invalidateQueries({queryKey:[N,"list"]}),o.invalidateQueries({queryKey:["chapters",a]})}})},Je=a=>{const o=Z();return ee({mutationFn:async({learningId:x,data:p})=>(await B.updateForBook(a,x,p)).data,onSuccess:()=>{o.invalidateQueries({queryKey:[N,"detail",a]}),o.invalidateQueries({queryKey:[N,"list"]}),o.invalidateQueries({queryKey:["chapters",a]})}})},Ke=a=>{const o=Z();return ee({mutationFn:async x=>{await B.deleteForBook(a,x)},onSuccess:()=>{o.invalidateQueries({queryKey:[N,"detail",a]}),o.invalidateQueries({queryKey:[N,"list"]}),o.invalidateQueries({queryKey:["chapters",a]})}})},De=a=>{const o=Z();return ee({mutationFn:async({learningId:x,skillIds:p})=>(await B.updateSkills(a,x,p)).data,onSuccess:()=>{o.invalidateQueries({queryKey:[N,"detail",a]}),o.invalidateQueries({queryKey:[N,"list"]}),o.invalidateQueries({queryKey:["chapters",a]})}})},Me=a=>{const o=Z(),[x,p]=f.useState(null),[n,w]=f.useState(null),[m,i]=f.useState({topic:"",topicEn:"",topicJa:"",content:"",contentEn:"",contentJa:""}),[P,J]=f.useState(!1),[L,l]=f.useState(null),S=Qe(a),A=Je(a),$=Ke(a),K=De(a),h=S.isPending||A.isPending||$.isPending||K.isPending,g=()=>{p(null),w(null),i({topic:"",topicEn:"",topicJa:"",content:"",contentEn:"",contentJa:""}),J(!1)},R=()=>{x&&q(),P&&i({topic:"",topicEn:"",topicJa:"",content:"",contentEn:"",contentJa:""}),J(r=>!r),l(null)},C=async()=>{if(!(!m.topic||!m.content))try{l(null),await S.mutateAsync(m),g()}catch(r){console.error("Failed to add learning:",r),l("학습 내용 추가에 실패했습니다.")}},z=async r=>{if(!(!m.topic||!m.content))try{l(null),await B.createForChapter(a,r,m),g(),o.invalidateQueries({queryKey:[N,"detail",a]}),o.invalidateQueries({queryKey:["chapters",a]})}catch(u){console.error("Failed to add learning to chapter:",u),l("목차에 학습 내용 추가에 실패했습니다.")}},D=async(r,u)=>{if(confirm("이 학습 내용을 삭제하시겠습니까?"))try{l(null),u?(await B.deleteForChapter(a,u,r),console.log("✅ 목차 학습 내용 삭제 성공")):await $.mutateAsync(r),o.invalidateQueries({queryKey:[N,"detail",a]}),o.invalidateQueries({queryKey:["chapters",a]})}catch(E){console.error("Failed to delete learning:",E),l("학습 내용 삭제에 실패했습니다.")}},Y=(r,u)=>{J(!1),p(r._id),w(u||null),i({topic:r.topic,topicEn:r.topicEn||"",topicJa:r.topicJa||"",content:r.content,contentEn:r.contentEn||"",contentJa:r.contentJa||""}),l(null)},G=async()=>{if(!(!x||!m.topic||!m.content))try{if(l(null),n){const r=await B.updateForChapter(a,n,x,m);console.log("✅ 목차 학습 내용 수정 성공:",r.data)}else await A.mutateAsync({learningId:x,data:m});o.invalidateQueries({queryKey:[N,"detail",a]}),o.invalidateQueries({queryKey:["chapters",a]}),g()}catch(r){console.error("Failed to update learning:",r),l("학습 내용 수정에 실패했습니다.")}},q=()=>{g(),l(null)};return{editingLearningId:x,currentFormData:m,setCurrentFormData:i,showAddForm:P,isSaving:h,learningApiError:L,handleToggleAddForm:R,handleAddLearning:C,handleAddLearningToChapter:z,handleDeleteLearning:D,handleStartEdit:Y,handleSaveEdit:G,handleCancelEdit:q,handleSkillLinkChange:async(r,u,E)=>{const U=[N,"detail",a],H=["chapters",a],_=o.getQueryData(U),T=o.getQueryData(H);try{l(null);let y=[];const Q=(T||[]).flatMap(c=>c.learnings||[]).find(c=>c._id===r)||((_==null?void 0:_.learnings)||[]).find(c=>c._id===r);if(Q){const c=Q.skillIds||[];E?y=Array.from(new Set([...c,u])):y=c.filter(j=>j!==u)}else y=E?[u]:[];T&&o.setQueryData(H,c=>c&&c.map(j=>({...j,learnings:(j.learnings||[]).map(F=>F._id===r?{...F,skillIds:y}:F)}))),_&&o.setQueryData(U,c=>c&&(c.chapters&&c.chapters.length>0?{...c,chapters:c.chapters.map(j=>({...j,learnings:(j.learnings||[]).map(F=>F._id===r?{...F,skillIds:y}:F)}))}:{...c,learnings:(c.learnings||[]).map(j=>j._id===r?{...j,skillIds:y}:j)})),await K.mutateAsync({learningId:r,skillIds:y})}catch(y){console.error("Failed to update learning skills:",y),l("스킬 연결/해제에 실패했습니다."),T&&o.setQueryData(H,T),_?o.setQueryData(U,_):(o.invalidateQueries({queryKey:U}),o.invalidateQueries({queryKey:H}))}}}},Be=a=>a?a.replace(/```([\s\S]*?)```/g,'<pre class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg overflow-x-auto my-4"><code class="text-sm font-mono">$1</code></pre>').replace(/`([^`]+)`/g,'<code class="bg-gray-100 dark:bg-gray-800 px-1 py-0.5 rounded text-sm font-mono">$1</code>').replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/__(.*?)__/g,"<strong>$1</strong>").replace(/(^|[^*])\*([^*\s][^*]*[^*\s]|[^*\s])\*([^*]|$)/g,"$1<em>$2</em>$3").replace(/(^|[^_])\_([^_\s][^_]*[^_\s]|[^_\s])\_([^_]|$)/g,"$1<em>$2</em>$3").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" class="text-primary-600 hover:text-primary-700 underline" target="_blank" rel="noopener noreferrer">$1</a>').replace(/^### (.*$)/gm,'<h3 class="text-lg font-semibold text-gray-900 dark:text-white mt-4 mb-2">$1</h3>').replace(/^## (.*$)/gm,'<h2 class="text-xl font-semibold text-gray-900 dark:text-white mt-4 mb-2">$1</h2>').replace(/^# (.*$)/gm,'<h1 class="text-2xl font-bold text-gray-900 dark:text-white mt-4 mb-2">$1</h1>').replace(/^[\s]*[-*] (.*$)/gm,'<li class="ml-4">$1</li>').replace(/(<li class="ml-4">.*<\/li>)/s,'<ul class="list-disc list-inside my-2">$1</ul>').replace(/^> (.*$)/gm,'<blockquote class="border-l-4 border-primary-500 pl-4 italic text-gray-600 dark:text-gray-400 my-2">$1</blockquote>').replace(/^---$/gm,'<hr class="border-gray-300 dark:border-gray-600 my-4">').replace(/\n/g,"<br>"):"",Pe=(a,o=200)=>{if(!a)return 0;const x=a.trim().split(/\s+/).length,p=Math.ceil(x/o);return Math.max(1,p)},le=({learning:a,index:o,isAuthenticated:x,isEditing:p,currentFormData:n,setCurrentFormData:w,onStartEdit:m,onSaveEdit:i,onCancelEdit:P,onDelete:J,isSaving:L=!1,allSkillsMap:l,onSkillLinkChange:S,chapterId:A})=>{var q;const{t:$,i18n:K}=oe(),h=K.language,[g,R]=f.useState("ko"),C=f.useMemo(()=>l?(a.skillIds||[]).map(s=>l.get(s)).filter(s=>!!s):[],[a.skillIds,l]),z=s=>{var u;if(!S)return;const r=((u=a.skillIds)==null?void 0:u.includes(s))||!1;S(a._id,s,!r)},D=f.useMemo(()=>l?Array.from(l.values()):[],[l]),Y=s=>({backgroundColor:`${s}1A`,color:s}),G=s=>({backgroundColor:s,color:"#FFFFFF"});return e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*o},className:`card p-6 ${p?"border-2 border-primary-500 shadow-xl":""}`,children:p?e.jsxs("div",{className:"space-y-4",children:[e.jsx(qe,{activeLanguage:g,onChange:R}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"topic",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["학습 주제 ",g==="ko"&&e.jsx("span",{className:"text-red-500",children:"*"}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",g==="ko"?"🇰🇷 한국어":g==="en"?"🇺🇸 English":"🇯🇵 日本語",")"]})]}),g==="ko"&&e.jsx("input",{type:"text",id:"topic",value:n.topic,onChange:s=>w(r=>({...r,topic:s.target.value})),placeholder:"학습 주제를 입력하세요",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),g==="en"&&e.jsx("input",{type:"text",value:n.topicEn||"",onChange:s=>w(r=>({...r,topicEn:s.target.value})),placeholder:"Enter learning topic",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),g==="ja"&&e.jsx("input",{type:"text",value:n.topicJa||"",onChange:s=>w(r=>({...r,topicJa:s.target.value})),placeholder:"学習トピックを入力",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["학습 내용 ",g==="ko"&&e.jsx("span",{className:"text-red-500",children:"*"}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",g==="ko"?"🇰🇷 한국어":g==="en"?"🇺🇸 English":"🇯🇵 日本語",")"]})]}),g==="ko"&&e.jsx(X,{value:n.content,onChange:s=>w(r=>({...r,content:s})),placeholder:"학습 내용을 입력하세요. 리치텍스트 에디터를 사용하여 다양한 서식을 적용할 수 있습니다.",rows:8,className:"min-h-[200px]"}),g==="en"&&e.jsx(X,{value:n.contentEn||"",onChange:s=>w(r=>({...r,contentEn:s})),placeholder:"Enter learning content. Use the rich text editor to apply various formats.",rows:8,className:"min-h-[200px]"}),g==="ja"&&e.jsx(X,{value:n.contentJa||"",onChange:s=>w(r=>({...r,contentJa:s})),placeholder:"学習内容を入力してください。リッチテキストエディタを使用して、さまざまな書式を適用できます。",rows:8,className:"min-h-[200px]"})]}),x&&l&&D.length>0&&e.jsxs("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2",children:[e.jsx(se,{size:14,className:"text-primary-600"})," 관련 스킬 연결 (",((q=a.skillIds)==null?void 0:q.length)||0,"개 연결됨)"]}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-40 overflow-y-auto p-2 rounded-lg bg-gray-50 dark:bg-gray-700/50",children:D.map(s=>{var E;const r=(E=a.skillIds)==null?void 0:E.includes(s._id),u=s.color&&r?G(s.color):void 0;return e.jsxs("button",{onClick:()=>z(s._id),type:"button",className:`px-3 py-1 text-xs font-medium rounded-full transition-all ${r?"text-white hover:opacity-80":"bg-gray-200 text-gray-700 dark:bg-gray-600 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-500"}`,style:u,children:[r?"✔️":"➕"," ",s.name]},s._id)})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>i(),disabled:L||!n.topic.trim()||!n.content.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:L?"저장 중...":"수정"}),e.jsx("button",{onClick:P,className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"취소"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:M(h,a.topic,a.topicEn,a.topicJa)}),x&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>m(a,A),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-blue-600 dark:text-blue-400","aria-label":"수정",children:e.jsx(de,{size:16})}),e.jsx("button",{onClick:()=>J(a._id,A),className:"p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400","aria-label":"삭제",children:e.jsx(ce,{size:16})})]})]}),C.length>0&&e.jsxs("div",{className:"flex flex-wrap items-start gap-2 mb-4",children:[e.jsx(se,{size:16,className:"text-gray-500 dark:text-gray-400 mt-1 shrink-0",title:"관련 스킬"}),C.map(s=>{const r=s.color?Y(s.color):void 0;return e.jsx(W,{to:`/projects?skillId=${s._id}`,title:`${s.name} 스킬이 사용된 프로젝트 보기`,className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium transition-all hover:opacity-80 hover:ring-2",style:{...r,"--tw-ring-color":s.color||"#3B82F6"},children:s.name},s._id)})]}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300 leading-relaxed prose prose-sm max-w-none dark:prose-invert",children:(()=>{const s=M(h,a.content,a.contentEn,a.contentJa);return xe(s)==="editorjs"?e.jsx(me,{data:s,className:"min-h-[50px]"}):e.jsx("div",{className:"text-gray-600 dark:text-gray-300 leading-relaxed prose prose-sm max-w-none dark:prose-invert",dangerouslySetInnerHTML:{__html:Be(s)}})})()}),e.jsxs("div",{className:"mt-4 text-sm text-gray-500 dark:text-gray-500",children:[$("book.createdAt")," ",ge(a.createdAt)," (",Le(a.createdAt),") • ",Pe(a.content),$("book.minRead")]})]})})},Xe=()=>{const{id:a}=je(),o=ve(),x=ke(),{isAuthenticated:p}=Ne(),{t:n,i18n:w}=oe(),m=w.language,{data:i,isLoading:P,isError:J,error:L}=Ae(a),{data:l=[]}=we({queryKey:["chapters",a],queryFn:async()=>{var d;if(!a)return[];const t=await ie.getByBook(a);return((d=t.data)==null?void 0:d.data)||t.data||[]},enabled:!!a,staleTime:5*60*1e3}),{skillCategories:S}=Te(),A=$e(),$=J?(L==null?void 0:L.message)||"서적 정보를 불러오는 데 실패했습니다.":null,{editingLearningId:K,currentFormData:h,setCurrentFormData:g,showAddForm:R,isSaving:C,learningApiError:z,handleToggleAddForm:D,handleAddLearning:Y,handleAddLearningToChapter:G,handleDeleteLearning:q,handleStartEdit:s,handleSaveEdit:r,handleCancelEdit:u,handleSkillLinkChange:E}=Me(a),[U,H]=f.useState(null),[_,T]=f.useState(!1),[y,Q]=f.useState({title:"",titleEn:"",titleJa:"",order:((l==null?void 0:l.length)||0)+1}),[c,j]=f.useState(null),F=t=>{H(d=>d===t?null:t)},ue=async()=>{if(!y.title.trim()){alert(n("book.chapterTitleRequired"));return}try{await ie.create(a,y),T(!1),Q({title:"",titleEn:"",titleJa:"",order:((l==null?void 0:l.length)||0)+2})}catch(t){console.error("Failed to add chapter:",t),alert(n("book.chapterAddFailed"))}},I=f.useMemo(()=>{if(!l||!S)return[];const t=S.flatMap(b=>b.skills||[]),d=new Set;if(l.forEach(b=>{(b.learnings||[]).forEach(be=>{(be.skillIds||[]).forEach(fe=>{d.add(fe)})})}),d.size===0)return[];const v=b=>b>=90?"Expert":b>=70?"Proficient":b>=50?"Competent":"Basic";return t.filter(b=>b._id&&d.has(b._id)).map(b=>({...b,levelText:v(b.level||0)}))},[l,S]),ae=f.useMemo(()=>{const t=new Map;return I.forEach(d=>d._id&&t.set(d._id,d)),t},[I]),pe=t=>({backgroundColor:`${t}26`,color:t}),ye=async()=>{if(confirm(n("book.confirmDelete")))try{await A.mutateAsync(a),o("/books")}catch(t){console.error("Failed to delete book:",t)}},te=A.isPending,re=f.useMemo(()=>i!=null&&i.learnings?[...i.learnings].sort((t,d)=>new Date(d.createdAt).getTime()-new Date(t.createdAt).getTime()):[],[i==null?void 0:i.learnings]);if(P)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-primary-600 border-t-transparent rounded-full animate-spin"})});if(!i)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(V,{className:"text-6xl text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400",children:"서적을 찾을 수 없습니다"}),e.jsx(W,{to:"/books",state:x.state,className:"text-primary-600 hover:text-primary-700 mt-4 inline-block",children:n("book.backToList")})]})});const he=t=>Array.from({length:5},(d,v)=>e.jsx(Fe,{className:v<t?"text-yellow-500":"text-gray-300 dark:text-gray-600"},v));return e.jsx("section",{className:"section-padding bg-white dark:bg-dark-900 min-h-screen",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[($||z)&&e.jsx(k.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-dark-800 dark:text-red-400",role:"alert",children:$||z}),e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:e.jsxs(W,{to:"/books",state:x.state,className:"inline-flex items-center gap-2 text-primary-600 hover:text-primary-700 mb-6",children:[e.jsx(Ce,{})," ",n("book.backToList")]})}),e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card p-8 mb-8",children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-8",children:[e.jsx("div",{children:i.coverImage?e.jsx("img",{src:i.coverImage,alt:i.title,className:"w-full h-auto object-cover rounded-lg shadow-lg",loading:"eager",decoding:"async",width:"400",height:"533"}):e.jsx("div",{className:"w-full aspect-[3/4] bg-gradient-to-br from-primary-400 to-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(V,{className:"text-white text-6xl"})})}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:i.categoryIds&&i.categoryIds.length>0?i.categoryIds.map(t=>{const d=typeof t=="string"?t:t==null?void 0:t.name;return d?e.jsx("span",{className:"px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 rounded-full text-sm font-medium",children:d},typeof t=="string"?t:t==null?void 0:t._id):null}):i.category&&e.jsx("span",{className:"px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 rounded-full text-sm font-medium",children:i.category})}),p&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{to:"/admin",state:{tab:"books",editId:i._id},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-blue-600 dark:text-blue-400","aria-label":"서적 수정",children:e.jsx(de,{})}),e.jsx("button",{onClick:ye,disabled:te,className:`p-2 rounded-lg text-red-600 dark:text-red-400 transition-colors ${te?"opacity-50 cursor-not-allowed":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,"aria-label":"서적 삭제",children:te?e.jsx("div",{className:"w-4 h-4 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):e.jsx(ce,{})})]})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2",children:M(m,i.title,i.titleEn,i.titleJa)}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400 mb-6",children:M(m,i.author,i.authorEn,i.authorJa)}),e.jsxs("div",{className:"flex flex-wrap gap-6 text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[he(i.rating),e.jsxs("span",{className:"font-medium ml-1",children:[i.rating,"/5"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{}),e.jsxs("span",{children:[n("book.readDate")," ",ge(i.readDate)]})]})]})]})]})}),I.length>0&&e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"card p-6 mb-8",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(_e,{className:"text-primary-600"})," 이 책을 통해 학습한 핵심 스킬"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(t=>{const d=t.color?pe(t.color):void 0;return e.jsxs(W,{to:`/projects?skillId=${t._id}`,title:`${t.name} 스킬이 사용된 모든 프로젝트 보기`,className:"inline-flex items-center px-3 py-1 rounded-lg text-sm font-medium hover:ring-2 transition-all hover:opacity-80",style:{...d,"--tw-ring-color":t.color||"#3B82F6"},children:[t.name,e.jsxs("span",{className:"ml-1 text-xs font-semibold",style:{color:t.color||"#3B82F6"},children:["[",t.levelText,"]"]})]},t._id)})})]}),M(m,i.learningContent,i.learningContentEn,i.learningContentJa)&&e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"card p-6 mb-8",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(V,{className:"text-primary-600"})," 학습 내용"]}),e.jsx("div",{className:"prose prose-gray dark:prose-invert max-w-none",children:(()=>{const t=M(m,i.learningContent,i.learningContentEn,i.learningContentJa)||"";return xe(t).type==="editorjs"?e.jsx(me,{data:t,className:"min-h-[100px]"}):e.jsx("div",{dangerouslySetInnerHTML:{__html:t},className:"min-h-[100px]"})})()})]}),e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 flex-wrap gap-3",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:n("book.learningContent")}),p&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>T(!_),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg transition-colors",children:[e.jsx(V,{})," ",n(_?"book.cancel":"book.addChapter")]}),(!l||l.length===0)&&e.jsxs("button",{type:"button",onClick:D,className:"flex items-center gap-2 bg-primary-600 hover:bg-primary-700 text-white font-medium px-4 py-2 rounded-lg transition-colors",children:[e.jsx(ne,{})," ",n(R?"book.cancel":"book.newLearning")]})]})]}),e.jsx(O,{children:_&&e.jsxs(k.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"card p-6 mb-6 overflow-hidden",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:n("book.newChapter")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["목차 제목 (한국어) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:y.title,onChange:t=>Q({...y,title:t.target.value}),placeholder:"예: Chapter 1. 기초 개념",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"목차 제목 (English)"}),e.jsx("input",{type:"text",value:y.titleEn,onChange:t=>Q({...y,titleEn:t.target.value}),placeholder:"e.g., Chapter 1. Basic Concepts",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"목차 제목 (日本語)"}),e.jsx("input",{type:"text",value:y.titleJa,onChange:t=>Q({...y,titleJa:t.target.value}),placeholder:"例：第1章。基本概念",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:ue,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"추가"}),e.jsx("button",{type:"button",onClick:()=>{T(!1),Q({title:"",titleEn:"",titleJa:"",order:((l==null?void 0:l.length)||0)+1})},className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"취소"})]})]})]})}),e.jsx(O,{children:R&&e.jsxs(k.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"card p-6 mb-6 overflow-hidden",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:n("book.newLearning")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"topic",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("book.learningTopic")}),e.jsx("input",{type:"text",id:"topic",value:h.topic,onChange:t=>g(d=>({...d,topic:t.target.value})),placeholder:"학습 주제를 입력하세요",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("book.learningContent")}),e.jsx(X,{value:h.content,onChange:t=>g(d=>({...d,content:t})),placeholder:n("book.learningContent"),rows:8,className:"min-h-[200px]"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:Y,disabled:C||!h.topic.trim()||!h.content.trim(),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:C?"저장 중...":"추가"}),e.jsx("button",{onClick:D,className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"취소"})]})]})]})}),(()=>l&&l.length>0?e.jsx("div",{className:"space-y-4",children:l.map(t=>{const d=U===t._id;return e.jsxs("div",{className:"card p-6 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 -m-6 p-6 rounded-lg transition-colors",onClick:()=>F(t._id),children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white flex-1",children:[M(m,t.title,t.titleEn,t.titleJa),e.jsxs("span",{className:"ml-3 text-sm font-normal text-gray-500 dark:text-gray-400",children:["(",(t.learnings||[]).length,n("book.learningEntries"),")"]})]}),e.jsx(k.span,{animate:{rotate:d?90:0},transition:{duration:.3},className:"text-primary-600 dark:text-primary-400 text-xl ml-4",children:e.jsx(Se,{})})]}),e.jsx(O,{children:d&&e.jsx(k.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:e.jsxs("div",{className:"space-y-6 pt-6 mt-6 border-t border-gray-200 dark:border-gray-700",children:[p&&e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("button",{type:"button",onClick:()=>j(c===t._id?null:t._id),className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white font-medium px-4 py-2 rounded-lg transition-colors text-sm",children:[e.jsx(ne,{})," ",c===t._id?n("book.cancel"):n("book.addLearningContent")]})}),e.jsx(O,{children:c===t._id&&e.jsxs(k.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"card p-6 mb-6 overflow-hidden bg-green-50 dark:bg-green-900/10",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:n("book.newLearning")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[n("book.learningTopic")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:h.topic,onChange:v=>g({...h,topic:v.target.value}),placeholder:"학습 주제를 입력하세요",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:[n("book.learningContent")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(X,{value:h.content,onChange:v=>g({...h,content:v}),placeholder:n("book.learningContent"),rows:6,className:"min-h-[150px]"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>G(t._id),disabled:C||!h.topic.trim()||!h.content.trim(),className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:C?"저장 중...":"추가"}),e.jsx("button",{type:"button",onClick:()=>j(null),className:"px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"취소"})]})]})]})}),(t.learnings||[]).map((v,b)=>e.jsx(le,{learning:v,index:b,isAuthenticated:p,isEditing:K===v._id,currentFormData:h,setCurrentFormData:g,onStartEdit:s,onSaveEdit:r,onCancelEdit:u,onDelete:q,isSaving:C,allSkillsMap:ae,onSkillLinkChange:E,chapterId:t._id},v._id)),(!t.learnings||t.learnings.length===0)&&!c&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:n("book.noLearningInChapter")})]})})})]},t._id)})}):re.length>0?e.jsx("div",{className:"space-y-6",children:re.map((t,d)=>e.jsx(le,{learning:t,index:d,isAuthenticated:p,isEditing:K===t._id,currentFormData:h,setCurrentFormData:g,onStartEdit:s,onSaveEdit:r,onCancelEdit:u,onDelete:q,isSaving:C,allSkillsMap:ae,onSkillLinkChange:E},t._id))}):e.jsxs("div",{className:"card p-12 text-center",children:[e.jsx(V,{className:"text-6xl text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400",children:n("book.noLearningYet")})]}))()]})]})})};export{Xe as default};
